2025-02-03T13:48:00 -- extraction timestamp...

new record.....

change record ::
everything is new

Final DataFrame with all the required changes
+----------+-----------+----------------+----------+--------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+----------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+--------+------+
|profile_id|identity_id|alias_type_value|is_primary|documented_names                            |extraction_timestamp|source_name|_FixedRef|party_sub_type|party_type|app_profile_id                      |alias_id                        |alias_hash                      |id_documents                                                                            |documents_hash                  |version|active_flag|updated_at         |end_date|action|
+----------+-----------+----------------+----------+--------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+----------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+--------+------+
|306       |4314       |A.K.A.          |false     |[{Entity Name -> BNC}]                      |2025-02-03T13:48:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|22212fe7402b70f899b0a15ec9258662|fc571eaf276935ab7348ccd80cc85c50|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 13:55:00|NULL    |insert|
|306       |4314       |A.K.A.          |false     |[{Entity Name -> NATIONAL BANK OF CUBA}]    |2025-02-03T13:48:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|f9004db4b2f32f82cefb09f7f18c99fc|141c750e51c092c1d9d7c2016484807c|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 13:55:00|NULL    |insert|
|306       |4314       |Name            |true      |[{Entity Name -> BANCO NACIONAL DE CUBA}]   |2025-02-03T13:48:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|ede8e91aa1a9605e12dc6a83cb3fa656|2eb7512c21eb2d74453af42d4d01baa9|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 13:55:00|NULL    |insert|
|36        |4375       |A.K.A.          |false     |[{Entity Name -> AERO-CARIBBEAN}]           |2025-02-03T13:48:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|116a005f0a2f631f46825c3418e5f2e2|68c0cec691cc75a1369f4a1b812f25b0|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 13:55:00|NULL    |insert|
|36        |4375       |Name            |true      |[{Entity Name -> AEROCARIBBEAN AIRLINES}]   |2025-02-03T13:48:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|4d4cfcf465449d84fbc386f95bdfeace|5c13a0bb2f0e5b49c97348a0ae4443f0|[{Passport, Mexico (MX), 2, 040070827, []}, {Passport, Mexico (MX), 3, 07040059504, []}]|4be89a1acc0e6ba33c5ebefb88a0d1af|1      |Y          |2025-02-03 13:55:00|NULL    |insert|
|173       |4310       |A.K.A.          |false     |[{Entity Name -> AVIA IMPORT}]              |2025-02-03T13:48:00 |OFAC       |173      |Unknown       |Entity    |APP_f7e6c85504ce6e82442c770f7c8606f0|1c68084605ac4fa2a29df74e06cfe1f9|0ee686624c7cbaa782821267b55b1fdb|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 13:55:00|NULL    |insert|
|173       |4310       |Name            |true      |[{Entity Name -> ANGLO-CARIBBEAN CO., LTD.}]|2025-02-03T13:48:00 |OFAC       |173      |Unknown       |Entity    |APP_f7e6c85504ce6e82442c770f7c8606f0|1aaf49ae22332cce1e9a11d5b13b7a9e|7e56eefb7a5a7dc45235cce166fbfd43|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 13:55:00|NULL    |insert|
+----------+-----------+----------------+----------+--------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+----------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+--------+------+

+----------+-----------+----------------+----------+--------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+----------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+--------+------+
|profile_id|identity_id|alias_type_value|is_primary|documented_names                            |extraction_timestamp|source_name|_FixedRef|party_sub_type|party_type|app_profile_id                      |alias_id                        |alias_hash                      |id_documents                                                                            |documents_hash                  |version|active_flag|updated_at         |end_date|action|
+----------+-----------+----------------+----------+--------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+----------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+--------+------+
|306       |4314       |A.K.A.          |false     |[{Entity Name -> BNC}]                      |2025-02-03T14:21:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|22212fe7402b70f899b0a15ec9258662|fc571eaf276935ab7348ccd80cc85c50|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 14:22:00|NULL    |insert|
|306       |4314       |A.K.A.          |false     |[{Entity Name -> NATIONAL BANK OF CUBA}]    |2025-02-03T14:21:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|f9004db4b2f32f82cefb09f7f18c99fc|141c750e51c092c1d9d7c2016484807c|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 14:22:00|NULL    |insert|
|306       |4314       |Name            |true      |[{Entity Name -> BANCO NACIONAL DE CUBA}]   |2025-02-03T14:21:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|ede8e91aa1a9605e12dc6a83cb3fa656|2eb7512c21eb2d74453af42d4d01baa9|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 14:22:00|NULL    |insert|
|36        |4375       |A.K.A.          |false     |[{Entity Name -> AERO-CARIBBEAN}]           |2025-02-03T14:21:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|116a005f0a2f631f46825c3418e5f2e2|68c0cec691cc75a1369f4a1b812f25b0|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 14:22:00|NULL    |insert|
|36        |4375       |Name            |true      |[{Entity Name -> AEROCARIBBEAN AIRLINES}]   |2025-02-03T14:21:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|4d4cfcf465449d84fbc386f95bdfeace|5c13a0bb2f0e5b49c97348a0ae4443f0|[{Passport, Mexico (MX), 2, 040070827, []}, {Passport, Mexico (MX), 3, 07040059504, []}]|4be89a1acc0e6ba33c5ebefb88a0d1af|1      |Y          |2025-02-03 14:22:00|NULL    |insert|
|173       |4310       |A.K.A.          |false     |[{Entity Name -> AVIA IMPORT}]              |2025-02-03T14:21:00 |OFAC       |173      |Unknown       |Entity    |APP_f7e6c85504ce6e82442c770f7c8606f0|1c68084605ac4fa2a29df74e06cfe1f9|0ee686624c7cbaa782821267b55b1fdb|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 14:22:00|NULL    |insert|
|173       |4310       |Name            |true      |[{Entity Name -> ANGLO-CARIBBEAN CO., LTD.}]|2025-02-03T14:21:00 |OFAC       |173      |Unknown       |Entity    |APP_f7e6c85504ce6e82442c770f7c8606f0|1aaf49ae22332cce1e9a11d5b13b7a9e|7e56eefb7a5a7dc45235cce166fbfd43|NULL                                                                                    |NULL                            |1      |Y          |2025-02-03 14:22:00|NULL    |insert|
+----------+-----------+----------------+----------+--------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+----------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+--------+------+




2025-02-03T13:54:00 -- extraction timestamp

change record ::
profile_36 has 1 alias ( not primary ) is deleted in this dataset and then there is an additional document added
so change data capture should have primary record being udpated so it should be version 2 .. and then a document will be showcased in the active record..
old version 1 of the primary should be active flag as n and end date will be added to it..

profile 173 is not changed..
profile 306 has 3 aliases
 primary record is changed here because the name on the primary is changed so we should be seeing a new primary record with version 1
 and the old primary record should be updated with end date and active flag as n.

Final DataFrame with all the required changes
+----------+-----------+----------------+----------+----------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+-------------------+------+
|profile_id|identity_id|alias_type_value|is_primary|documented_names                              |extraction_timestamp|source_name|_FixedRef|party_sub_type|party_type|app_profile_id                      |alias_id                        |alias_hash                      |id_documents                                                                                                                          |documents_hash                  |version|active_flag|updated_at         |end_date           |action|
+----------+-----------+----------------+----------+----------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+-------------------+------+
|36        |4375       |Name            |true      |[{Entity Name -> AEROCARIBBEAN AIRLINES}]     |2025-02-03T13:48:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|4d4cfcf465449d84fbc386f95bdfeace|5c13a0bb2f0e5b49c97348a0ae4443f0|[{Passport, Mexico (MX), 2, 040070827, []}, {Passport, Mexico (MX), 3, 07040059504, []}]                                              |4be89a1acc0e6ba33c5ebefb88a0d1af|1      |N          |2025-02-03 14:02:00|2025-02-03 14:02:00|delete|
|36        |4375       |Name            |true      |[{Entity Name -> AEROCARIBBEAN AIRLINES}]     |2025-02-03T13:54:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|4d4cfcf465449d84fbc386f95bdfeace|5c13a0bb2f0e5b49c97348a0ae4443f0|[{Passport, Mexico (MX), 2, 040070827, []}, {Passport, Mexico (MX), 3, 07040059504, []}, {Passport, Mexico (MX), 3, 070476559504, []}]|09e63c9c963d3a55b709793b40e7e630|2      |Y          |2025-02-03 14:02:00|NULL               |update|
|36        |4375       |A.K.A.          |false     |[{Entity Name -> AERO-CARIBBEAN}]             |2025-02-03T13:48:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|116a005f0a2f631f46825c3418e5f2e2|68c0cec691cc75a1369f4a1b812f25b0|NULL                                                                                                                                  |NULL                            |1      |N          |2025-02-03 14:02:00|2025-02-03 14:02:00|delete|
|306       |4314       |Name            |true      |[{Entity Name -> BANCO NACIONAL BANK DE CUBA}]|2025-02-03T13:54:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|b531e682fdd9a3a81c8a4ecef48b86f7|810f4323fab27fd95b267d56ce1dbb7d|NULL                                                                                                                                  |NULL                            |1      |Y          |2025-02-03 14:02:00|NULL               |insert|
|306       |4314       |Name            |true      |[{Entity Name -> BANCO NACIONAL DE CUBA}]     |2025-02-03T13:48:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|ede8e91aa1a9605e12dc6a83cb3fa656|2eb7512c21eb2d74453af42d4d01baa9|NULL                                                                                                                                  |NULL                            |1      |N          |2025-02-03 14:02:00|2025-02-03 14:02:00|delete|
+----------+-----------+----------------+----------+----------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+-------------------+------+


2025-02-03T14:08:00 -- extraction timestamp

change record ::
profile 36 added a new alias which is not primary and then modified the name on the primary record but same documents from the previous version
so technically we should be seeing 2 new insert records one for primary and one for alias and then old primary being active_flag as n.

profile 173 changed the primary name so a new version of the primary record will be created and the old one will be deactivated.

profile 306 chnaged the primary name so we should be seeing another new version on the primary and also a document is now added to the primary record. aliases remain same.

Final DataFrame with all the required changes
+----------+-----------+----------------+----------+------------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+-------------------+------+
|profile_id|identity_id|alias_type_value|is_primary|documented_names                                |extraction_timestamp|source_name|_FixedRef|party_sub_type|party_type|app_profile_id                      |alias_id                        |alias_hash                      |id_documents                                                                                                                          |documents_hash                  |version|active_flag|updated_at         |end_date           |action|
+----------+-----------+----------------+----------+------------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+-------------------+------+
|36        |4375       |A.K.A.          |false     |[{Entity Name -> AERO-CARIBBEAN AIR}]           |2025-02-03T14:08:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|13047045538a5bc367ca2842a95b07e4|efdda1619afc186a8f789c24deab5640|NULL                                                                                                                                  |NULL                            |1      |Y          |2025-02-03 14:12:00|NULL               |insert|
|36        |4375       |Name            |true      |[{Entity Name -> AEROCARIBBEAN AIRLINES22}]     |2025-02-03T14:08:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|7f03c3d60d781af9301c924027ea070a|ee85755a7cc100721b9728abebc732d5|[{Passport, Mexico (MX), 2, 040070827, []}, {Passport, Mexico (MX), 3, 07040059504, []}, {Passport, Mexico (MX), 3, 070476559504, []}]|09e63c9c963d3a55b709793b40e7e630|1      |Y          |2025-02-03 14:12:00|NULL               |insert|
|36        |4375       |Name            |true      |[{Entity Name -> AEROCARIBBEAN AIRLINES}]       |2025-02-03T13:54:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|4d4cfcf465449d84fbc386f95bdfeace|5c13a0bb2f0e5b49c97348a0ae4443f0|[{Passport, Mexico (MX), 2, 040070827, []}, {Passport, Mexico (MX), 3, 07040059504, []}, {Passport, Mexico (MX), 3, 070476559504, []}]|09e63c9c963d3a55b709793b40e7e630|2      |N          |2025-02-03 14:12:00|2025-02-03 14:12:00|delete|
|173       |4310       |Name            |true      |[{Entity Name -> ANGLO-CARIBBEAN IMP CO., LTD.}]|2025-02-03T14:08:00 |OFAC       |173      |Unknown       |Entity    |APP_f7e6c85504ce6e82442c770f7c8606f0|4e21d19ae9a3c7f576f25a808a2feb44|952818a9818ab6ec225368e31d35c43f|NULL                                                                                                                                  |NULL                            |1      |Y          |2025-02-03 14:12:00|NULL               |insert|
|173       |4310       |Name            |true      |[{Entity Name -> ANGLO-CARIBBEAN CO., LTD.}]    |2025-02-03T13:48:00 |OFAC       |173      |Unknown       |Entity    |APP_f7e6c85504ce6e82442c770f7c8606f0|1aaf49ae22332cce1e9a11d5b13b7a9e|7e56eefb7a5a7dc45235cce166fbfd43|NULL                                                                                                                                  |NULL                            |1      |N          |2025-02-03 14:12:00|2025-02-03 14:12:00|delete|
|306       |4314       |Name            |true      |[{Entity Name -> BANCO NACIONAL DE CUBA}]       |2025-02-03T14:08:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|ede8e91aa1a9605e12dc6a83cb3fa656|2eb7512c21eb2d74453af42d4d01baa9|[{Passport, Mexico (MX), 3, 070476559504, []}]                                                                                        |5b63eb4a9d422876d30691d22f9bbf86|1      |Y          |2025-02-03 14:12:00|NULL               |insert|
|306       |4314       |Name            |true      |[{Entity Name -> BANCO NACIONAL BANK DE CUBA}]  |2025-02-03T13:54:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|b531e682fdd9a3a81c8a4ecef48b86f7|810f4323fab27fd95b267d56ce1dbb7d|NULL                                                                                                                                  |NULL                            |1      |N          |2025-02-03 14:12:00|2025-02-03 14:12:00|delete|
+----------+-----------+----------------+----------+------------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+-------------------+------+

+----------+-----------+----------------+----------+------------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+-------------------+------+
|profile_id|identity_id|alias_type_value|is_primary|documented_names                                |extraction_timestamp|source_name|_FixedRef|party_sub_type|party_type|app_profile_id                      |alias_id                        |alias_hash                      |id_documents                                                                                                                          |documents_hash                  |version|active_flag|updated_at         |end_date           |action|
+----------+-----------+----------------+----------+------------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+-------------------+------+
|36        |4375       |A.K.A.          |false     |[{Entity Name -> AERO-CARIBBEAN AIR}]           |2025-02-03T14:32:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|13047045538a5bc367ca2842a95b07e4|efdda1619afc186a8f789c24deab5640|NULL                                                                                                                                  |NULL                            |1      |Y          |2025-02-03 14:32:00|NULL               |insert|
|36        |4375       |Name            |true      |[{Entity Name -> AEROCARIBBEAN AIRLINES22}]     |2025-02-03T14:32:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|7f03c3d60d781af9301c924027ea070a|ee85755a7cc100721b9728abebc732d5|[{Passport, Mexico (MX), 2, 040070827, []}, {Passport, Mexico (MX), 3, 07040059504, []}, {Passport, Mexico (MX), 3, 070476559504, []}]|09e63c9c963d3a55b709793b40e7e630|1      |Y          |2025-02-03 14:32:00|NULL               |insert|
|36        |4375       |Name            |true      |[{Entity Name -> AEROCARIBBEAN AIRLINES}]       |2025-02-03T14:26:00 |OFAC       |36       |Unknown       |Entity    |APP_19ca14e7ea6328a42e0eb13d585e4c22|4d4cfcf465449d84fbc386f95bdfeace|5c13a0bb2f0e5b49c97348a0ae4443f0|[{Passport, Mexico (MX), 2, 040070827, []}, {Passport, Mexico (MX), 3, 07040059504, []}, {Passport, Mexico (MX), 3, 070476559504, []}]|09e63c9c963d3a55b709793b40e7e630|2      |N          |2025-02-03 14:32:00|2025-02-03 14:32:00|delete|
|173       |4310       |Name            |true      |[{Entity Name -> ANGLO-CARIBBEAN IMP CO., LTD.}]|2025-02-03T14:32:00 |OFAC       |173      |Unknown       |Entity    |APP_f7e6c85504ce6e82442c770f7c8606f0|4e21d19ae9a3c7f576f25a808a2feb44|952818a9818ab6ec225368e31d35c43f|NULL                                                                                                                                  |NULL                            |1      |Y          |2025-02-03 14:32:00|NULL               |insert|
|173       |4310       |Name            |true      |[{Entity Name -> ANGLO-CARIBBEAN CO., LTD.}]    |2025-02-03T14:21:00 |OFAC       |173      |Unknown       |Entity    |APP_f7e6c85504ce6e82442c770f7c8606f0|1aaf49ae22332cce1e9a11d5b13b7a9e|7e56eefb7a5a7dc45235cce166fbfd43|NULL                                                                                                                                  |NULL                            |1      |N          |2025-02-03 14:32:00|2025-02-03 14:32:00|delete|
|306       |4314       |Name            |true      |[{Entity Name -> BANCO NACIONAL DE CUBA}]       |2025-02-03T14:32:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|ede8e91aa1a9605e12dc6a83cb3fa656|2eb7512c21eb2d74453af42d4d01baa9|[{Passport, Mexico (MX), 3, 070476559504, []}]                                                                                        |5b63eb4a9d422876d30691d22f9bbf86|1      |Y          |2025-02-03 14:32:00|NULL               |insert|
|306       |4314       |Name            |true      |[{Entity Name -> BANCO NACIONAL BANK DE CUBA}]  |2025-02-03T14:26:00 |OFAC       |306      |Unknown       |Entity    |APP_b2eb7349035754953b57a32e2841bda5|b531e682fdd9a3a81c8a4ecef48b86f7|810f4323fab27fd95b267d56ce1dbb7d|NULL                                                                                                                                  |NULL                            |1      |N          |2025-02-03 14:32:00|2025-02-03 14:32:00|delete|
+----------+-----------+----------------+----------+------------------------------------------------+--------------------+-----------+---------+--------------+----------+------------------------------------+--------------------------------+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------+--------------------------------+-------+-----------+-------------------+-------------------+------+
